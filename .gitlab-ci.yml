---
services:
  - docker:dind

stages:
  - build

rpm-build:
  stage: build
  image: centos:7
  before_script:
    - yum -y install
        epel-release
        git
        rpm-build
        rpmdevtools
        make
  script:
    - mkdir -p rpmbuild/{SOURCES,RPMS,SRPMS}
    - spectool -g -C rpmbuild/SOURCES build/bouncer.spec
    - rpmbuild --define "_topdir `pwd`/rpmbuild" -bb build/bouncer.spec
  artifacts:
    paths:
      - "*.rpm"